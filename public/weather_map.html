<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylsheet" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4MykfDptSwWPPeSBADg68S6bmkDuL3Dc"
  type="text/javascript"></script>
    <style media="screen">
      .day {
        text-align: center;
        position: relative;
        float: left;
        width: 30vw;
        /*height: 40vh;*/
        background-color: white;
        border: 1px solid #EEE;
        margin: .3vw;
        border-radius: 7px;
      }
      .forecast {
        position: relative;
        margin: 50px auto;
      }
      .day h5 {
        font-family: "Helvetica";
        font-weight: lighter;
        text-align: center;
        font-size: 2em;
        line-height: .2vh;
        -webkit-margin-before: 1.6em;
        -webkit-margin-after: .6em;
        -webkit-margin-start: 0px;
        -webkit-margin-end: 0px;
      }
      .day img{
        position: relative;
        white-space: nowrap;
        overflow: auto;
        width: 80px;
        bottom: -1vh;
      }
      .day p {
        font-family: "Helvetica";
        font-size: 1.3em;
      }
      #map-canvas {
        height: 40vh;
        width: 90vw;
      }
    </style>
  </head>
  <body>
    <h2 id="city"></h2>
      <section class="forecast">
        <div class="day" id="day1"></div>
        <div class="day" id="day2"></div>
        <div class="day" id="day3"></div>
        <div id="map-canvas"></div>
      </section>

    <script
      src="https://code.jquery.com/jquery-3.2.1.js"
      integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
      crossorigin="anonymous"></script>
  <script>
    // key: 8b21151a7c136222f70cba36e55c6af9
    // temp: data.list[1].temp.day
  $(document).ready(function() {

  function makeRequest (lat, lon) {
    var request = $.get("http://api.openweathermap.org/data/2.5/forecast/daily",
    {
      APPID: "8b21151a7c136222f70cba36e55c6af9",
      lat: lat,
      lon: lon,
      units: "imperial"
    });
    request.done(function(data){
      console.log(data);
      hiLo(data);
      weatherIcon(data);
      precip(data);
      humidity(data);
      wind(data);
      pressure(data)
    })
    .fail(function(jqHxr, status, error){
      console.log(status);
      console.log(error);
    })
  }

    function hiLo(data) {
      //get city name
      $("#city").text(data.city.name);
      //get 3 day forecast
      for (var i = 1; i < 4; i++){
        var low = parseInt(data.list[i].temp.min)
        var high = parseInt(data.list[i].temp.max)
        $("#day" + i).html("<h5>" + low + "° / " + high + "°</h5>");
        }
    };
    function weatherIcon(data) {
      //get icon
      for (var i = 1; i < 4; i++){
        var iconCode = (data.list[i].weather[0].icon);
        var getIcon = ("http://openweathermap.org/img/w/" + iconCode + ".png")
        $("#day" + [i]).append("<img src='" + getIcon + "'>");
      }
    };
    function precip(data) {
      for (var i = 1; i < 4; i++) {
        var rainAmt = (data.list[i].weather[0].main);
        var rainDesc = (data.list[i].weather[0].description);
      $("#day" + [i]).append("<p><strong>" + rainAmt + ":</strong> " + rainDesc +" </p>");
      }
    }
    function humidity(data) {
      for (var i = 1; i < 4; i++) {
        var humidity = (data.list[i].humidity);
        $("#day" + [i]).append("<p><strong>Humidity: </strong>" + humidity + "</p>")
      }
    }
    function wind(data) {
      for (var i = 1; i < 4; i++) {
        var windSpeed = (data.list[i].speed);
        $("#day" + [i]).append("<p><strong>Wind: </strong>" + windSpeed + "</p>")
      }
    }
    function pressure(data) {
      for (var i = 1; i < 4; i ++) {
        var barometer = (data.list[i].pressure);
        $("#day" + [i]).append("<p><strong>Pressure: </strong>" + barometer + "</p>")
      }
    }
    function createMap() {
      var mapOptions = {
        zoom: 20,
        center: {
          lat: 29.426791,
          lng: -98.489602
        },
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
      var address = "300 Alamo Plaza, San Antonio, TX, 78205";
      makeRequest("29.4241", "-98.4937");
      google.maps.event.addListener(map, 'click', function(event) {
        placeMarker(event.latLng);
      });

      function placeMarker(location) {
        var marker = new google.maps.Marker({
          position: location,
          map: map
        });
        var lat = (location.lat());
        var lon = (location.lng());
        makeRequest(lat, lon);


      };
    }

    createMap();
    // data.city.coord.lat;
    // data.city.coord.lon;

    //on click add marker
    //get the lat and lon from that marker

    //pass that to makeRequest function

    //run makeRequest

    //animate the marker





  });

  </script>
  </body>
</html>
