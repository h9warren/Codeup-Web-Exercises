<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylsheet" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4MykfDptSwWPPeSBADg68S6bmkDuL3Dc"
  type="text/javascript"></script>
    <style media="screen">
      body{
        margin-top: 0px;
        margin-right: 0px;
        margin-bottom: 0px;
        margin-left: 0px;
      }
      .day {
        text-align: center;
        position: relative;
        float: left;
        width: 28vw;
        /*height: 40vh;*/
        background-color: rgba(0,0,0,.4);
        border: 1px solid rgba(255,255,255,.3);
        margin: .8vw;
        border-radius: 7px;
      }
      .day h5 {
        font-family: "Helvetica";
        font-weight: lighter;
        text-align: center;
        font-size: 2em;
        line-height: .2vh;
        -webkit-margin-before: 1.6em;
        -webkit-margin-after: .6em;
        -webkit-margin-start: 0px;
        -webkit-margin-end: 0px;
        color: white;
      }
      .day img{
        position: relative;
        white-space: nowrap;
        overflow: auto;
        width: 80px;
        bottom: -1vh;
      }
      .day p {
        -webkit-margin-before: .6em;
        -webkit-margin-after: .6em;
        font-family: "Helvetica";
        font-size: 1.3em;
        color: white;
      }
      #map-canvas {
        position: absolute;
        top: 0px;
        height: 100vh;
        width: 100vw;
      }
      #top-bar {
        position: absolute;
        /*float: left;*/
        background-color: #000;
        opacity: .6;
        width: 100%;
        height: 430px;

      }
      #city {
        position: absolute;
        color: white;
        font-family: "Helvetica";
        font-weight: lighter;
        margin-left: 5vw;
        margin-top: 3vh;
        font-size: 2em;
        text-transform: uppercase;
        letter-spacing: .3em;
        text-align: center;
      }
      .forecast{
        position: absolute;
        margin: 80px 5vw 10vh 5vw;
      }
      .search{
        float: right;
        position: relative;
        margin-right: 6vw;
        top: 4vh;
        height: 37px;
        width: 221px;
        background-color: rgba(0,0,0,1);
        border: none;
        border-radius: 3px;
        color: #878787;
        /* text-transform: uppercase; */
        /* letter-spacing: .2em; */
        padding: 10px;
        font-size: 17px;
      }
    </style>
  </head>
  <body>
      <div id="map-canvas"></div>
      <div id="top-bar"></div>
      <div class="search">
        <input id="searchCity" type="search" name="enterCity" placeholder="Enter a city">
        <button id="searchNow">GO</button>
      </div>
      <h2 id="city"></h2>
      <section class="forecast">
        <div class="day" id="day1"></div>
        <div class="day" id="day2"></div>
        <div class="day" id="day3"></div>
      </section>

    <script
      src="https://code.jquery.com/jquery-3.2.1.js"
      integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
      crossorigin="anonymous"></script>
    <script type="text/javascript" src="/js/myStyles.js"></script>
  <script>
  var myStyles = [
              {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
              {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
              {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
              {
                featureType: 'administrative.locality',
                elementType: 'labels.text.fill',
                stylers: [{color: '#d59563'}]
              },
              {
                featureType: 'poi',
                elementType: 'labels.text.fill',
                stylers: [{color: '#d59563'}]
              },
              {
                featureType: 'poi.park',
                elementType: 'geometry',
                stylers: [{color: '#263c3f'}]
              },
              {
                featureType: 'poi.park',
                elementType: 'labels.text.fill',
                stylers: [{color: '#6b9a76'}]
              },
              {
                featureType: 'road',
                elementType: 'geometry',
                stylers: [{color: '#38414e'}]
              },
              {
                featureType: 'road',
                elementType: 'geometry.stroke',
                stylers: [{color: '#212a37'}]
              },
              {
                featureType: 'road',
                elementType: 'labels.text.fill',
                stylers: [{color: '#9ca5b3'}]
              },
              {
                featureType: 'road.highway',
                elementType: 'geometry',
                stylers: [{color: '#746855'}]
              },
              {
                featureType: 'road.highway',
                elementType: 'geometry.stroke',
                stylers: [{color: '#1f2835'}]
              },
              {
                featureType: 'road.highway',
                elementType: 'labels.text.fill',
                stylers: [{color: '#f3d19c'}]
              },
              {
                featureType: 'transit',
                elementType: 'geometry',
                stylers: [{color: '#2f3948'}]
              },
              {
                featureType: 'transit.station',
                elementType: 'labels.text.fill',
                stylers: [{color: '#d59563'}]
              },
              {
                featureType: 'water',
                elementType: 'geometry',
                stylers: [{color: '#17263c'}]
              },
              {
                featureType: 'water',
                elementType: 'labels.text.fill',
                stylers: [{color: '#515c6d'}]
              },
              {
                featureType: 'water',
                elementType: 'labels.text.stroke',
                stylers: [{color: '#17263c'}]
              }
            ]

    // key: 8b21151a7c136222f70cba36e55c6af9
    // temp: data.list[1].temp.day
  $(document).ready(function() {

  function makeRequest (lat, lon) {
    console.log(lat, lon);
    var request = $.get("http://api.openweathermap.org/data/2.5/forecast/daily",
    {
      APPID: "8b21151a7c136222f70cba36e55c6af9",
      lat: lat,
      lon: lon,
      units: "imperial"
    });
    request.done(function(data){
      console.log(data);
      hiLo(data);
      weatherIcon(data);
      precip(data);
      humidity(data);
      wind(data);
      pressure(data)
    })
    .fail(function(jqHxr, status, error){
      console.log(status);
      console.log(error);
    })
  }

    function hiLo(data) {
      //get city name
      $("#city").text(data.city.name);
      //get 3 day forecast
      for (var i = 1; i < 4; i++){
        var low = parseInt(data.list[i].temp.min)
        var high = parseInt(data.list[i].temp.max)
        $("#day" + i).html("<h5>" + low + "° / " + high + "°</h5>");
        }
    };
    function weatherIcon(data) {
      //get icon
      for (var i = 1; i < 4; i++){
        var iconCode = (data.list[i].weather[0].icon);
        var getIcon = ("http://openweathermap.org/img/w/" + iconCode + ".png")
        $("#day" + [i]).append("<img src='" + getIcon + "'>");
      }
    };
    function precip(data) {
      for (var i = 1; i < 4; i++) {
        var rainAmt = (data.list[i].weather[0].main);
        var rainDesc = (data.list[i].weather[0].description);
      $("#day" + [i]).append("<p><strong>" + rainAmt + ":</strong> " + rainDesc +" </p>");
      }
    }
    function humidity(data) {
      for (var i = 1; i < 4; i++) {
        var humidity = (data.list[i].humidity);
        $("#day" + [i]).append("<p><strong>Humidity: </strong>" + humidity + "</p>")
      }
    }
    function wind(data) {
      for (var i = 1; i < 4; i++) {
        var windSpeed = (data.list[i].speed);
        $("#day" + [i]).append("<p><strong>Wind: </strong>" + windSpeed + "</p>")
      }
    }
    function pressure(data) {
      for (var i = 1; i < 4; i ++) {
        var barometer = (data.list[i].pressure);
        $("#day" + [i]).append("<p><strong>Pressure: </strong>" + barometer + "</p>")
      }
    }
    function createMap() {

      var mapOptions = {
        zoom: 16,
        styles: myStyles,
        center: {
          lat: 29.426791,
          lng: -98.489602
        },
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
      var address = "300 Alamo Plaza, San Antonio, TX, 78205";
      makeRequest("29.4241", "-98.4937");
      google.maps.event.addListener(map, 'click', function(event) {
        placeMarker(event.latLng);
      });

      var marker;
      function placeMarker(location) {
        if (marker == null) {
            marker = new google.maps.Marker({
            position: location,
            map: map,
            animation: google.maps.Animation.DROP
          });
        } else {
          marker.setPosition(location);

        }

        var lat = (location.lat());
        var lon = (location.lng());
        makeRequest(lat, lon);


      };
    }

    createMap();

    //create a search box

    //take the value of the search box

    //send to request function
    $("#searchNow").click(function() {
      var searchLoc = $("#searchCity").val();
      console.log(searchLoc);
      var geocoder = new google.maps.Geocoder();
      geocoder.geocode({
        address: searchLoc
      }, function(results, status) {
        console.log(results);
        if (status == google.maps.GeocoderStatus.OK) {
          var Lat = results[0].geometry.location.lat();
          var Lng = results[0].geometry.location.lng();
          // map.setCenter({lat: Lat, lng: Lng});
          makeRequest(Lat, Lng);
          var myOptions = {
            zoom: 11,
            center: new google.maps.LatLng(Lat, Lng)
          };
        }
      });

    })
    //update map







  });

  </script>
  </body>
</html>
